<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Backend Configuration - AppFlowy Documentation</title>
  <link rel="stylesheet" href="assets/docs-style.css">
</head>
<body>
  <div class="docs-container">
    <aside class="docs-sidebar">
      <a href="index.html" class="docs-logo">
        <span style="font-size: 32px;">üìö</span>
        <h1>AppFlowy Docs</h1>
      </a>
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Search documentation...">
      </div>
      <nav id="docs-nav" class="docs-nav"></nav>
    </aside>

    <main class="docs-main">
      <header class="docs-header">
        <div id="breadcrumb" class="breadcrumb"></div>
      </header>

      <article class="docs-content">
        <h1>Backend Configuration</h1>
        <p>This page contains the full backend environment configuration reference (moved from the old Environment Setup page).</p>

        <div class="card">
          <h2>Environment Files Explained</h2>
          <div class="file-type template">
            <div class="file-name">dev.env</div>
            <div class="file-purpose">Development Configuration Template</div>
          </div>
          <div class="file-type template">
            <div class="file-name">deploy.env</div>
            <div class="file-purpose">Production Configuration Template</div>
          </div>
          <div class="file-type active">
            <div class="file-name">.env</div>
            <div class="file-purpose">Active Environment File (Auto-generated)</div>
          </div>
          <div class="file-type secret">
            <div class="file-name">.env.dev.secret / .env.deploy.secret</div>
            <div class="file-purpose">Secret Value Overrides</div>
          </div>
        </div>

        <div class="card">
          <h2>Quick Commands</h2>
          <h3>Generate Environment File</h3>
          <pre class="code-block"><code># Interactive environment file generation
./script/generate_env.sh

# The script will guide you through:
# 1. Selecting base template (dev.env or deploy.env)
# 2. Optional secret file integration
# 3. Generating final .env file</code></pre>

          <h3>Run Local Server (Development)</h3>
          <pre class="code-block"><code># First-time setup (prepare SQLx metadata, reset DB)
./script/run_local_server.sh --reset --sqlx

# First-time setup without SQLx preparation
./script/run_local_server.sh --reset

# Ongoing development (recommended without watch)
./script/run_local_server.sh --sqlx

# Optional: watch for changes (may block AI from running cargo check)
./script/run_local_server.sh --sqlx --watch</code></pre>

          <h3>Alternative: Bring Up Containers Only</h3>
          <pre class="code-block"><code># Start all services with development configuration
docker-compose -f docker-compose-dev.yml up

# Start in background (detached mode)
docker-compose -f docker-compose-dev.yml up -d

# View logs
docker-compose -f docker-compose-dev.yml logs -f</code></pre>

          <h3>Create Secret Override File</h3>
          <pre class="code-block"><code># Create development secrets file
cp env.dev.secret.example .env.dev.secret

# Edit with your real values
$EDITOR .env.dev.secret

# Example content:
# GOTRUE_JWT_SECRET=your_real_jwt_secret_here
# AI_OPENAI_API_KEY=your_openai_api_key
# GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=your_google_client_id</code></pre>
        </div>

        <div class="card">
          <h2>Common Configuration</h2>
          <h3>Database Settings</h3>
          <pre class="code-block"><code>DATABASE_URL=postgres://postgres:password@localhost:5432/postgres
POSTGRES_USER=postgres
POSTGRES_DB=postgres
POSTGRES_PASSWORD=password</code></pre>

          <h3>Authentication (GoTrue)</h3>
          <pre class="code-block"><code>GOTRUE_ADMIN_EMAIL=admin@example.com
GOTRUE_ADMIN_PASSWORD=password
GOTRUE_JWT_SECRET=hello456  # Change this in production!
GOTRUE_JWT_EXP=7200</code></pre>

          <h3>OAuth Providers (Google example)</h3>
          <pre class="code-block"><code># Enable Google OAuth
GOTRUE_EXTERNAL_GOOGLE_ENABLED=true
GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=your_google_client_id
GOTRUE_EXTERNAL_GOOGLE_SECRET=your_google_client_secret

# Public site URL (used by auth redirects)
GOTRUE_SITE_URL=http://localhost:3000</code></pre>
          <p>See detailed SAML instructions in <a href="okta-saml.html">Okta SAML</a>.</p>

          <h3>File Storage (MinIO)</h3>
          <pre class="code-block"><code>AWS_ACCESS_KEY=minioadmin
AWS_SECRET=minioadmin
APPFLOWY_S3_USE_MINIO=true
APPFLOWY_S3_MINIO_URL=http://localhost:9000</code></pre>
        </div>

        <div class="card">
          <h2>Security & Tips</h2>
          <ul>
            <li>Never commit <code>.env</code> or <code>.env.*.secret</code>.</li>
            <li>Run <code>script/run_local_server.sh</code> from a clean shell; pre-set DB env vars may override <code>.env</code>.</li>
          </ul>
          <pre class="code-block"><code># If your shell has conflicting variables, unset them first:
unset POSTGRES_HOST POSTGRES_PORT POSTGRES_USER POSTGRES_PASSWORD DATABASE_URL SQLX_OFFLINE
./script/run_local_server.sh</code></pre>

          <h3>Useful Flags and Environment Variables</h3>
          <pre class="code-block"><code># Flags
--sqlx      # Prepare SQLx metadata (required for clean builds)
--reset     # Reset database schema and data (no prompt)
--watch     # Auto-rebuild on file changes

# Environment variables
SKIP_SQLX_PREPARE=true
SKIP_APPFLOWY_CLOUD=true</code></pre>
        </div>
      </article>

      <footer class="docs-footer">
        <p>¬© 2024 AppFlowy. Built with ‚ù§Ô∏è for developers.</p>
      </footer>
    </main>
  </div>
  <script src="assets/docs-script.js"></script>
</body>
</html>
