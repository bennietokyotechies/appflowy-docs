<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Database Architecture - AppFlowy Documentation</title>
  <link rel="stylesheet" href="../assets/docs-style.css">
</head>
<body>
  <div class="docs-container">
    <!-- Sidebar -->
    <aside class="docs-sidebar">
      <a href="../index.html" class="docs-logo">
        <span style="font-size: 32px;">üìö</span>
        <h1>Klever Appflowy</h1>
      </a>
      
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Search documentation...">
      </div>
      
      <nav id="docs-nav" class="docs-nav">
        <!-- Navigation will be inserted here by JavaScript -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-main">
      <header class="docs-header">
        <div id="breadcrumb" class="breadcrumb">
          <!-- Breadcrumb will be inserted here by JavaScript -->
        </div>
      </header>

      <article class="docs-content">
        <h1>AppFlowy Database Architecture</h1>
        
        <p>AppFlowy's database system provides a flexible, collaborative data management platform that supports multiple view types and real-time synchronization across clients.</p>

        <div class="card">
          <h2>üìä Database Concept Overview</h2>
          
          <p>In AppFlowy, a "database" is not a traditional relational database but a <strong>flexible data structure</strong> that provides:</p>
          
          <ul>
            <li><strong>Multiple Views</strong>: Same data displayed as Grid (spreadsheet), Board (kanban), or Calendar</li>
            <li><strong>Rich Field Types</strong>: Text, numbers, dates, select options, checkboxes, URLs, relations</li>
            <li><strong>Flexible Schema</strong>: Fields can be added, modified, or removed dynamically</li>
            <li><strong>Collaborative Editing</strong>: Real-time updates with conflict resolution</li>
            <li><strong>View-Specific Configuration</strong>: Each view can have its own filters, sorting, and grouping</li>
          </ul>

          <div class="alert info">
            <strong>Core Principle:</strong> AppFlowy databases are designed around the concept of "structured flexibility" - providing the power of a database with the ease of use of a spreadsheet.
          </div>
        </div>

        <div class="card">
          <h2>üèóÔ∏è Architecture Overview</h2>
          
          <h3>Frontend Architecture (Flutter/Dart)</h3>
          <ul>
            <li><strong>UI Components</strong>: View-specific widgets (GridView, BoardView, CalendarView)</li>
            <li><strong>Controllers</strong>: Manage state and business logic for each view type</li>
            <li><strong>BLoC Pattern</strong>: Event-driven state management for reactive UI updates</li>
            <li><strong>Local Caching</strong>: Multi-layer caching system for performance optimization</li>
          </ul>

          <h3>Backend Architecture (Rust)</h3>
          <ul>
            <li><strong>Collab Engine</strong>: Y.js-based collaborative editing with operational transforms</li>
            <li><strong>Database Service</strong>: Domain-driven design with clear separation of concerns</li>
            <li><strong>Storage Layer</strong>: Persistent storage with real-time synchronization</li>
            <li><strong>Event System</strong>: Event-driven architecture for reactive updates</li>
          </ul>

          <h3>Communication Layer</h3>
          <ul>
            <li><strong>Protocol Buffers</strong>: Type-safe communication between frontend and backend</li>
            <li><strong>WebSocket/gRPC</strong>: Real-time bidirectional communication</li>
            <li><strong>Event Broadcasting</strong>: Efficient change propagation to connected clients</li>
          </ul>
        </div>

        <div class="card">
          <h2>üóÉÔ∏è Data Modeling</h2>
          
          <h3>Core Data Structures</h3>
          
          <h4>Database</h4>
          <ul>
            <li><strong>Metadata</strong>: Name, description, creation info</li>
            <li><strong>Fields</strong>: Column definitions with type and configuration</li>
            <li><strong>Views</strong>: Different presentations of the same data</li>
            <li><strong>Rows</strong>: Individual records containing cells</li>
          </ul>

          <h4>Field Types</h4>
          <table>
            <thead>
              <tr>
                <th>Field Type</th>
                <th>Description</th>
                <th>Configuration Options</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>RichText</td>
                <td>Formatted text with styling</td>
                <td>Font, color, alignment</td>
              </tr>
              <tr>
                <td>Number</td>
                <td>Numeric values</td>
                <td>Format, precision, currency</td>
              </tr>
              <tr>
                <td>DateTime</td>
                <td>Date and time values</td>
                <td>Format, timezone, range</td>
              </tr>
              <tr>
                <td>SingleSelect</td>
                <td>Choose one option</td>
                <td>Options, colors, default</td>
              </tr>
              <tr>
                <td>MultiSelect</td>
                <td>Choose multiple options</td>
                <td>Options, colors, limits</td>
              </tr>
              <tr>
                <td>Checkbox</td>
                <td>Boolean true/false</td>
                <td>Default state</td>
              </tr>
              <tr>
                <td>URL</td>
                <td>Web links</td>
                <td>Validation, display format</td>
              </tr>
            </tbody>
          </table>

          <h4>View System</h4>
          <p>Each view maintains its own configuration while sharing the underlying data:</p>
          <ul>
            <li><strong>Grid View</strong>: Spreadsheet-like table with rows and columns</li>
            <li><strong>Board View</strong>: Kanban-style cards organized by status field</li>
            <li><strong>Calendar View</strong>: Timeline display based on date fields</li>
          </ul>
        </div>

        <div class="card">
          <h2>‚ö° Technical Components</h2>
          
          <h3>Collaborative Editing Engine</h3>
          <ul>
            <li><strong>Y.js Integration</strong>: Conflict-free replicated data types (CRDTs)</li>
            <li><strong>Operational Transforms</strong>: Real-time conflict resolution</li>
            <li><strong>Change Tracking</strong>: Granular change detection and propagation</li>
            <li><strong>Offline Support</strong>: Local changes sync when connection restored</li>
          </ul>

          <h3>Performance Optimization</h3>
          <ul>
            <li><strong>Cell-Level Updates</strong>: Minimal change propagation</li>
            <li><strong>Virtual Scrolling</strong>: Efficient rendering of large datasets</li>
            <li><strong>Incremental Loading</strong>: Progressive data fetching</li>
            <li><strong>Smart Caching</strong>: Multi-layer caching strategy</li>
          </ul>

          <h3>Data Flow</h3>
          <ol>
            <li><strong>User Action</strong>: User modifies data in any view</li>
            <li><strong>Event Generation</strong>: Action converted to domain event</li>
            <li><strong>Collaboration Layer</strong>: Event processed through Y.js CRDT</li>
            <li><strong>Storage Update</strong>: Changes persisted to storage layer</li>
            <li><strong>Change Broadcast</strong>: Updates sent to all connected clients</li>
            <li><strong>UI Synchronization</strong>: Frontend receives and applies changes</li>
          </ol>
        </div>

        <div class="card">
          <h2>üîß Key Design Principles</h2>
          
          <ul>
            <li><strong>Event-Driven Architecture</strong>: All changes flow through events for consistency</li>
            <li><strong>Domain-Driven Design</strong>: Clear separation between different business domains</li>
            <li><strong>Type Safety</strong>: Protocol buffers ensure type safety across language boundaries</li>
            <li><strong>Scalable Synchronization</strong>: Efficient real-time collaboration at scale</li>
            <li><strong>View Independence</strong>: Each view type can evolve independently</li>
            <li><strong>Extensible Field System</strong>: Easy to add new field types and behaviors</li>
          </ul>

          <div class="alert success">
            <strong>Architecture Benefits:</strong> This design enables AppFlowy to provide spreadsheet-like flexibility while maintaining database-level consistency and performance.
          </div>
        </div>
      </article>

      <footer class="docs-footer">
        <p>¬© 2024 Klever. Built with ‚ù§Ô∏è for developers.</p>
      </footer>
    </main>
  </div>

  <script src="../assets/docs-script.js"></script>
</body>
</html>