<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Environment Setup - AppFlowy Documentation</title>
  <link rel="stylesheet" href="../assets/docs-style.css">
</head>
<body>
  <div class="docs-container">
    <!-- Sidebar -->
    <aside class="docs-sidebar">
      <a href="../index.html" class="docs-logo">
        <span style="font-size: 32px;">üìö</span>
        <h1>Klever Appflowy</h1>
      </a>
      
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Search documentation...">
      </div>
      
      <nav id="docs-nav" class="docs-nav">
        <!-- Navigation will be inserted here by JavaScript -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-main">
      <header class="docs-header">
        <div id="breadcrumb" class="breadcrumb">
          <!-- Breadcrumb will be inserted here by JavaScript -->
        </div>
      </header>

      <article class="docs-content">
        <h1>Environment Setup</h1>
        
        <p>Complete guide for setting up both Backend and Frontend environments for local development.</p>

        <h2>Table of Contents</h2>
        <ul>
          <li><a href="#prerequisites">Prerequisites</a></li>
          <li><a href="#backend-setup">Backend Setup</a>
            <ul>
              <li><a href="#environment-configuration">Environment Configuration</a></li>
              <li><a href="#google-oauth-setup">Google OAuth Setup</a></li>
              <li><a href="#start-backend-services">Start Backend Services</a></li>
            </ul>
          </li>
          <li><a href="#frontend-setup">Frontend Setup</a>
            <ul>
              <li><a href="#quick-start">Quick Start</a></li>
              <li><a href="#manual-setup">Manual Setup</a></li>
              <li><a href="#available-scripts">Available Scripts</a></li>
            </ul>
          </li>
          <li><a href="#troubleshooting">Troubleshooting</a></li>
          <li><a href="#configuration-reference">Configuration Reference</a></li>
        </ul>

        <h2 id="prerequisites">Prerequisites</h2>
        
        <p><strong>Backend Requirements:</strong></p>
        <ul>
          <li>Docker & Docker Compose</li>
          <li>Rust (if building manually)</li>
          <li>PostgreSQL access</li>
        </ul>

        <p><strong>Frontend Requirements:</strong></p>
        <ul>
          <li>Node.js 18.20.0 or higher</li>
          <li>pnpm (auto-installed by setup)</li>
          <li>Modern browser</li>
        </ul>

        <h2 id="backend-setup">Backend Setup</h2>

        <h3 id="environment-configuration">Environment Configuration</h3>
        
        <p>Generate your active <code>.env</code> file using the interactive script:</p>
        
        <pre><code>cd appflowy-backend
./script/generate_env.sh</code></pre>

        <p><strong>Environment Files:</strong></p>
        <ul>
          <li><code>dev.env</code> - Development template with safe defaults</li>
          <li><code>deploy.env</code> - Production template</li>
          <li><code>.env</code> - Active environment file (auto-generated)</li>
          <li><code>.env.dev.secret</code> - Secret value overrides (optional)</li>
        </ul>

        <h3 id="google-oauth-setup">Google OAuth Setup</h3>
        
        <p>Required for SSO authentication:</p>
        
        <ol>
          <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console ‚Üí Credentials</a></li>
          <li>Create OAuth client ID ‚Üí Web application</li>
          <li>Add authorized redirect URIs for your domain</li>
          <li>Copy Client ID and Secret to your <code>.env</code> file</li>
        </ol>

        <pre><code>GOTRUE_EXTERNAL_GOOGLE_ENABLED=true
GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=your_client_id
GOTRUE_EXTERNAL_GOOGLE_SECRET=your_client_secret
GOTRUE_SITE_URL=http://localhost:3000</code></pre>

        <h3 id="start-backend-services">Start Backend Services</h3>

        <p><strong>Method 1: Using Script (Recommended)</strong></p>
        <pre><code>./script/run_local_server.sh</code></pre>

        <p><strong>Method 2: Docker Compose Only</strong></p>
        <pre><code>docker compose -f docker-compose-dev.yml up -d</code></pre>

        <p><strong>Method 3: Manual Start</strong></p>
        <pre><code># Start services
docker compose -f docker-compose-dev.yml up -d

# Run AppFlowy Cloud manually
SQLX_OFFLINE=true cargo run --bin appflowy_cloud</code></pre>

        <h2 id="frontend-setup">Frontend Setup</h2>

        <h3 id="quick-start">Quick Start (Recommended)</h3>
        
        <pre><code># Clone and setup in one command
git clone https://github.com/AppFlowy-IO/AppFlowy-Web.git
cd AppFlowy-Web
./setup.sh

# Start development server
pnpm run dev</code></pre>

        <h3 id="manual-setup">Manual Setup</h3>
        
        <pre><code># Install dependencies
pnpm install

# Setup environment
cp dev.env .env.local

# Start development server
pnpm run dev</code></pre>

        <p><strong>Backend Connection:</strong> Update <code>.env.local</code> with your backend URL:</p>
        <pre><code>VITE_CLOUD_URL=http://localhost:8000
VITE_WS_URL=ws://localhost:8000</code></pre>

        <h3 id="available-scripts">Available Scripts</h3>
        
        <ul>
          <li><code>pnpm run dev</code> - Start development server</li>
          <li><code>pnpm run build</code> - Build for production</li>
          <li><code>pnpm run test</code> - Run tests</li>
          <li><code>pnpm run lint</code> - Run ESLint</li>
          <li><code>pnpm run type-check</code> - Run TypeScript checks</li>
        </ul>

        <h2 id="troubleshooting">Troubleshooting</h2>

        <h3>Backend Issues</h3>
        
        <p><strong>Docker Compose errors:</strong></p>
        <ul>
          <li>Make sure ports 5432, 6379, 8000, 9000, 9001 are available</li>
          <li>Run <code>./script/generate_env.sh</code> to create <code>.env</code> file</li>
          <li>Check Docker daemon is running</li>
        </ul>

        <p><strong>Database connection failed:</strong></p>
        <ul>
          <li>Verify PostgreSQL is running: <code>docker compose ps</code></li>
          <li>Check database credentials in <code>.env</code></li>
          <li>Reset database: <code>docker compose down -v && docker compose up</code></li>
        </ul>

        <p><strong>GoTrue authentication issues:</strong></p>
        <ul>
          <li>Ensure <code>GOTRUE_JWT_SECRET</code> is consistent across services</li>
          <li>Check Google OAuth client ID and secret are correct</li>
          <li>Verify redirect URIs in Google Console</li>
        </ul>

        <h3>Frontend Issues</h3>
        
        <p><strong>Build failures:</strong></p>
        <ul>
          <li>Delete <code>node_modules</code> and run <code>pnpm install</code></li>
          <li>Clear pnpm cache: <code>pnpm store prune</code></li>
          <li>Check Node.js version is 18.20.0 or higher</li>
        </ul>

        <p><strong>Backend connection errors:</strong></p>
        <ul>
          <li>Verify backend is running on <code>http://localhost:8000</code></li>
          <li>Check <code>VITE_CLOUD_URL</code> in <code>.env.local</code></li>
          <li>Ensure CORS is enabled in backend configuration</li>
        </ul>

        <p><strong>Hot reload not working:</strong></p>
        <ul>
          <li>Check if files are being watched correctly</li>
          <li>Try restarting the development server</li>
          <li>Verify file permissions in the project directory</li>
        </ul>

        <h2 id="configuration-reference">Configuration Reference</h2>

        <h3>Common Environment Variables</h3>
        
        <pre><code># Database
DATABASE_URL=postgres://postgres:password@localhost:5432/postgres

# Authentication  
GOTRUE_JWT_SECRET=your-jwt-secret
GOTRUE_ADMIN_EMAIL=admin@example.com
GOTRUE_ADMIN_PASSWORD=password

# Storage
AWS_ACCESS_KEY=minioadmin
AWS_SECRET=minioadmin
APPFLOWY_S3_USE_MINIO=true
APPFLOWY_S3_MINIO_URL=http://localhost:9000

# Features
SPACE_ACL_ENABLED=true
PROJECT_ACL_ENABLED=true</code></pre>

        <h3>Quick Commands Reference</h3>
        
        <pre><code># Backend
./script/run_local_server.sh              # Start all services
docker compose -f docker-compose-dev.yml logs -f  # View logs
docker compose down                        # Stop services

# Frontend  
pnpm run dev                              # Development server
pnpm run build                            # Production build
pnpm run test                             # Run tests</code></pre>

        <p><strong>Need more details?</strong> Check the <a href="pages/database-architecture.html">Database Architecture</a> and <a href="pages/unified-space-project-architecture.html">System Architecture</a> documentation.</p>
      </article>

      <footer class="docs-footer">
        <p>¬© 2024 Klever. Built with ‚ù§Ô∏è for developers.</p>
      </footer>
    </main>
  </div>

  <script src="../assets/docs-script.js"></script>
</body>
</html>