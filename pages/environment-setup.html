<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Environment Setup - AppFlowy Documentation</title>
  <link rel="stylesheet" href="../assets/docs-style.css">
</head>
<body>
  <div class="docs-container">
    <!-- Sidebar -->
    <aside class="docs-sidebar">
      <a href="../index.html" class="docs-logo">
        <span style="font-size: 32px;">üìö</span>
        <h1>Klever Appflowy</h1>
      </a>
      
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Search documentation...">
      </div>
      
      <nav id="docs-nav" class="docs-nav">
        <!-- Navigation will be inserted here by JavaScript -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-main">
      <header class="docs-header">
        <div id="breadcrumb" class="breadcrumb">
          <!-- Breadcrumb will be inserted here by JavaScript -->
        </div>
      </header>

      <article class="docs-content">
        <h1>üöÄ Environment Setup</h1>
        <p>This page covers first-time setup for both Backend and Frontend, and a troubleshooting section. For full configuration references, see <a href="../backend-configuration.html">Backend Configuration</a> and <a href="../frontend-configuration.html">Frontend Configuration</a>.</p>

        <div class="card">
          <h2>üß≠ First-time Setup Overview</h2>
          <ul>
            <li><strong>Backend</strong>: generate <code>.env</code>, configure Google OAuth for SSO, enable default plugins, and start services with Docker Compose.</li>
            <li><strong>Frontend</strong>: clone repo, run <code>./setup.sh</code>, start dev server with <code>pnpm run dev</code>, and connect to the backend.</li>
          </ul>
        </div>

        <div class="card">
          <h2>üõ†Ô∏è Backend ‚Äî First-time Setup (Local)</h2>

          <h3>1) Set up environment</h3>
          <p>Run the generator to create your active <code>.env</code>:</p>
          <pre class="code-block"><code>cd ../appflowy-backend
./script/generate_env.sh</code></pre>
          <ul>
            <li><strong>Google OAuth (Required for SSO)</strong>: Provide your Google OAuth credentials during setup or add them to <code>.env</code> later. Common keys include:
              <ul>
                <li><code>GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID</code></li>
                <li><code>GOTRUE_EXTERNAL_GOOGLE_SECRET</code></li>
              </ul>
            </li>
            <li><strong>Enable default plugins</strong>: add these flags to <code>.env</code> to enable Space and Project ACL features:</li>
          </ul>
          <pre class="code-block"><code># Enable Space ACL feature
SPACE_ACL_ENABLED=true
PROJECT_ACL_ENABLED=true</code></pre>

          <h3>Google OAuth: create Client ID</h3>
          <ol>
            <li>Open <a href="https://console.cloud.google.com/apis/credentials/consent" target="_blank" rel="noopener noreferrer">OAuth consent screen</a> and configure your app (User type, app name, scopes).</li>
            <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank" rel="noopener noreferrer">Credentials</a> ‚Üí <em>Create Credentials</em> ‚Üí <strong>OAuth client ID</strong>.</li>
            <li>Select <em>Web application</em>, then add Authorized redirect URIs that match your GoTrue configuration.</li>
            <li>Copy the generated Client ID and Client Secret into your backend <code>.env</code> as shown below.</li>
          </ol>

          <div class="alert info">
            <strong>Note:</strong> The exact redirect URI depends on your GoTrue configuration. Check your <code>.env</code> for any redirect-related settings and ensure the Google Console redirect URI matches.
          </div>

          <h3>GoTrue .env keys (Google)</h3>
          <pre class="code-block"><code># Google OAuth ‚Äî required for SSO
GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=your_google_client_id
GOTRUE_EXTERNAL_GOOGLE_SECRET=your_google_client_secret</code></pre>

          <h3>2) Start backend services</h3>
          <pre class="code-block"><code># Start all services for development
docker-compose -f docker-compose-dev.yml up -d

# Tail logs
docker-compose -f docker-compose-dev.yml logs -f</code></pre>
        </div>

        <div class="card">
          <h2>üñ•Ô∏è Frontend ‚Äî First-time Setup (Local)</h2>
          <p>Follow the official flow from the frontend README.</p>
          <h3>1) Quick Start (Recommended)</h3>
          <pre class="code-block"><code># Clone the repository
git clone https://github.com/AppFlowy-IO/AppFlowy-Web.git
cd AppFlowy-Web

# One-command setup
./setup.sh

# Start development server
pnpm run dev

# Open the app
http://localhost:3000</code></pre>
          <h3>2) Connect to your backend</h3>
          <pre class="code-block"><code># In the frontend repo root
cp dev.env .env

# Edit .env to point to your backend endpoints and auth settings</code></pre>
          <p>See <code>frontend-configuration.html</code> for the full list of scripts and troubleshooting tips.</p>
        </div>

        <div class="card">
          <h2>üêõ Troubleshooting</h2>
          
          <h3>Docker Compose Can't Find Environment Variables</h3>
          <p><strong>Problem:</strong> PostgreSQL authentication errors, missing environment variables</p>
          <p><strong>Solution:</strong> Generate the <code>.env</code> file using the provided script</p>
          
          <h3>Services Won't Start</h3>
          <p><strong>Problem:</strong> Port conflicts, missing dependencies</p>
          <p><strong>Solution:</strong> Check that ports 5432, 6379, 9000, 9001, 9999 are available</p>
          
          <h3>GoTrue Authentication Issues</h3>
          <p><strong>Problem:</strong> JWT token validation fails</p>
          <p><strong>Solution:</strong> Ensure <code>GOTRUE_JWT_SECRET</code> is consistent across all services</p>
        </div>
      </article>

      <footer class="docs-footer">
        <p>¬© 2024 Klever. Built with ‚ù§Ô∏è for developers.</p>
      </footer>
    </main>
  </div>

  <script src="../assets/docs-script.js"></script>
</body>
</html>