<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Environment Setup - AppFlowy Documentation</title>
  <link rel="stylesheet" href="../assets/docs-style.css">
</head>
<body>
  <div class="docs-container">
    <!-- Sidebar -->
    <aside class="docs-sidebar">
      <a href="index.html" class="docs-logo">
        <span style="font-size: 32px;">üìö</span>
        <h1>Klever Appflowy</h1>
      </a>
      
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Search documentation...">
      </div>
      
      <nav id="docs-nav" class="docs-nav">
        <!-- Navigation will be inserted here by JavaScript -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-main">
      <header class="docs-header">
        <div id="breadcrumb" class="breadcrumb">
          <!-- Breadcrumb will be inserted here by JavaScript -->
        </div>
      </header>

      <article class="docs-content">
        <h1>üöÄ Environment Setup</h1>
        <p>AppFlowy Backend uses a sophisticated environment configuration system that separates templates, secrets, and active configuration files. This guide explains how each file works and when to use them.</p>
        
        <div class="card">
          <h2>üìã Overview</h2>
          <p>AppFlowy Backend uses a sophisticated environment configuration system that separates templates, secrets, and active configuration files. This guide explains how each file works and when to use them.</p>
          
          <div class="alert info">
            <strong>üéØ Quick Start:</strong> Run <code>./script/generate_env.sh</code> to interactively create your environment file, then use <code>docker-compose -f docker-compose-dev.yml up</code> to start the backend.
          </div>
        </div>

        <div class="card">
          <h2>üìÅ Environment Files Explained</h2>
          
          <h3>Development Configuration Template (dev.env)</h3>
          <table>
            <tr>
              <td><strong>Purpose:</strong></td>
              <td>Base template with safe development defaults</td>
            </tr>
            <tr>
              <td><strong>When used:</strong></td>
              <td>Local development environment setup</td>
            </tr>
            <tr>
              <td><strong>Contains:</strong></td>
              <td>Non-sensitive defaults, example values, dev-specific settings</td>
            </tr>
            <tr>
              <td><strong>Version Control:</strong></td>
              <td>‚úÖ Safe to commit</td>
            </tr>
          </table>

          <h3>Production Configuration Template (deploy.env)</h3>
          <table>
            <tr>
              <td><strong>Purpose:</strong></td>
              <td>Base template for production deployments</td>
            </tr>
            <tr>
              <td><strong>When used:</strong></td>
              <td>Production/staging environment setup</td>
            </tr>
            <tr>
              <td><strong>Contains:</strong></td>
              <td>Production-optimized settings, placeholder values</td>
            </tr>
            <tr>
              <td><strong>Version Control:</strong></td>
              <td>‚úÖ Safe to commit</td>
            </tr>
          </table>

          <h3>Active Environment File (.env)</h3>
          <table>
            <tr>
              <td><strong>Purpose:</strong></td>
              <td>The actual file used by Docker Compose and applications</td>
            </tr>
            <tr>
              <td><strong>When used:</strong></td>
              <td>Always - docker-compose reads this by default</td>
            </tr>
            <tr>
              <td><strong>Generated by:</strong></td>
              <td>./script/generate_env.sh script</td>
            </tr>
            <tr>
              <td><strong>Version Control:</strong></td>
              <td>‚ùå Never commit (SENSITIVE)</td>
            </tr>
          </table>

          <h3>Secret Value Overrides (.env.dev.secret / .env.deploy.secret)</h3>
          <table>
            <tr>
              <td><strong>Purpose:</strong></td>
              <td>Override sensitive values (API keys, passwords, etc.)</td>
            </tr>
            <tr>
              <td><strong>When used:</strong></td>
              <td>Optional - for storing real credentials</td>
            </tr>
            <tr>
              <td><strong>Contains:</strong></td>
              <td>Only sensitive keys to override (e.g., API_KEY=real_value)</td>
            </tr>
            <tr>
              <td><strong>Version Control:</strong></td>
              <td>‚ùå Never commit (HIGHLY SENSITIVE)</td>
            </tr>
          </table>
        </div>

        <div class="card">
          <h2>üîÑ Environment Setup Workflow</h2>
          
          <ol>
            <li><strong>Choose Base Template</strong> - Select <code>dev.env</code> for development or <code>deploy.env</code> for production</li>
            <li><strong>Add Secrets (Optional)</strong> - Create <code>.env.dev.secret</code> or <code>.env.deploy.secret</code> with real credentials</li>
            <li><strong>Generate Environment File</strong> - Run <code>./script/generate_env.sh</code> to create the final <code>.env</code> file</li>
            <li><strong>Start Services</strong> - Docker Compose automatically reads the <code>.env</code> file</li>
          </ol>
        </div>

        <div class="card">
          <h2>‚ö° Quick Commands</h2>
          
          <h3>Generate Environment File</h3>
          <pre><code># Interactive environment file generation
./script/generate_env.sh

# The script will guide you through:
# 1. Selecting base template (dev.env or deploy.env)
# 2. Optional secret file integration
# 3. Generating final .env file</code></pre>

          <h3>Start Development Environment</h3>
          <pre><code># Start all services with development configuration
docker-compose -f docker-compose-dev.yml up

# Start in background (detached mode)
docker-compose -f docker-compose-dev.yml up -d

# View logs
docker-compose -f docker-compose-dev.yml logs -f</code></pre>

          <h3>Create Secret Override File</h3>
          <pre><code># Create development secrets file
cp env.dev.secret.example .env.dev.secret

# Edit with your real values
nano .env.dev.secret

# Example content:
# GOTRUE_JWT_SECRET=your_real_jwt_secret_here
# AI_OPENAI_API_KEY=your_openai_api_key
# GOTRUE_EXTERNAL_GOOGLE_CLIENT_ID=your_google_client_id</code></pre>
        </div>

        <div class="card">
          <h2>üîß Common Configuration</h2>
          
          <h3>Database Settings</h3>
          <p>PostgreSQL configuration is automatically set up in the templates:</p>
          <pre><code>DATABASE_URL=postgres://postgres:password@localhost:5432/postgres
POSTGRES_USER=postgres
POSTGRES_DB=postgres  
POSTGRES_PASSWORD=password</code></pre>

          <h3>Authentication (GoTrue)</h3>
          <p>JWT and admin settings for the authentication service:</p>
          <pre><code>GOTRUE_ADMIN_EMAIL=admin@example.com
GOTRUE_ADMIN_PASSWORD=password
GOTRUE_JWT_SECRET=hello456  # Change this in production!
GOTRUE_JWT_EXP=7200</code></pre>

          <h3>File Storage (MinIO)</h3>
          <p>Object storage configuration for file uploads:</p>
          <pre><code>AWS_ACCESS_KEY=minioadmin
AWS_SECRET=minioadmin
APPFLOWY_S3_USE_MINIO=true
APPFLOWY_S3_MINIO_URL=http://localhost:9000</code></pre>
        </div>

        <div class="card">
          <h2>‚ö†Ô∏è Important Security Notes</h2>
          
          <div class="alert warning">
            <strong>üîê Never commit sensitive files:</strong> Always add <code>.env</code>, <code>.env.*.secret</code> files to your <code>.gitignore</code>
          </div>
          
          <div class="alert warning">
            <strong>üîë Change default secrets:</strong> The template files contain example values. Always use strong, unique secrets in production.
          </div>
          
          <div class="alert info">
            <strong>üí° Pro Tip:</strong> Use environment-specific secret files to override only the sensitive values you need, keeping the rest as defaults.
          </div>
        </div>

        <div class="card">
          <h2>üêõ Troubleshooting</h2>
          
          <h3>Docker Compose Can't Find Environment Variables</h3>
          <p><strong>Problem:</strong> PostgreSQL authentication errors, missing environment variables</p>
          <p><strong>Solution:</strong> Generate the <code>.env</code> file using the provided script</p>
          
          <h3>Services Won't Start</h3>
          <p><strong>Problem:</strong> Port conflicts, missing dependencies</p>
          <p><strong>Solution:</strong> Check that ports 5432, 6379, 9000, 9001, 9999 are available</p>
          
          <h3>GoTrue Authentication Issues</h3>
          <p><strong>Problem:</strong> JWT token validation fails</p>
          <p><strong>Solution:</strong> Ensure <code>GOTRUE_JWT_SECRET</code> is consistent across all services</p>
        </div>
      </article>

      <footer class="docs-footer">
        <p>¬© 2024 AppFlowy. Built with ‚ù§Ô∏è for developers.</p>
      </footer>
    </main>
  </div>

  <script src="../assets/docs-script.js"></script>
</body>
</html>