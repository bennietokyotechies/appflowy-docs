<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppFlowy Kanban Board Implementation - Technical Documentation</title>
    <style>
        :root {
            --primary-color: #8b5cf6;
            --secondary-color: #f3f4f6;
            --text-color: #1f2937;
            --border-color: #d1d5db;
            --code-bg: #f9fafb;
            --accent-color: #059669;
            --warning-color: #f59e0b;
            --success-color: #10b981;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: #fafbfc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: white;
            border-bottom: 2px solid var(--border-color);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #6b7280;
            font-size: 1.1rem;
            font-weight: 400;
        }
        
        nav {
            background: var(--secondary-color);
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: var(--primary-color);
            color: white;
        }
        
        main {
            padding: 40px 0;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        h2 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 20px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }
        
        h3 {
            color: var(--accent-color);
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }
        
        h4 {
            color: var(--text-color);
            font-size: 1.1rem;
            margin: 20px 0 10px 0;
            font-weight: 600;
        }
        
        p, li {
            margin-bottom: 12px;
        }
        
        ul, ol {
            margin-left: 25px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            position: relative;
        }
        
        .code-title {
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .inline-code {
            background: var(--code-bg);
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9em;
            border: 1px solid #e5e7eb;
        }
        
        .board-demo {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin: 25px 0;
            display: flex;
            gap: 20px;
            overflow-x: auto;
        }
        
        .demo-column {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            min-width: 250px;
            padding: 15px;
        }
        
        .demo-header {
            font-weight: 600;
            padding: 8px 12px;
            margin-bottom: 10px;
            background: var(--secondary-color);
            border-radius: 6px;
            color: var(--primary-color);
        }
        
        .demo-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .component-card {
            background: linear-gradient(135deg, #fafbfc 0%, #f1f5f9 100%);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .component-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .component-card h4 {
            color: var(--accent-color);
            margin-bottom: 12px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .feature-icon.drag { background: #ddd6fe; color: var(--primary-color); }
        .feature-icon.create { background: #dcfce7; color: var(--success-color); }
        .feature-icon.edit { background: #fef3c7; color: var(--warning-color); }
        .feature-icon.keyboard { background: #e0e7ff; color: #3730a3; }
        
        .highlight {
            background: linear-gradient(90deg, #fef3c7, #fbbf24);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .warning {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-left: 4px solid #ef4444;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-left: 4px solid #3b82f6;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-left: 4px solid #22c55e;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .flow-step {
            background: white;
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 15px 20px;
            text-align: center;
            min-width: 150px;
        }
        
        .flow-arrow {
            font-size: 1.5rem;
            color: var(--accent-color);
            font-weight: bold;
        }
        
        .architecture-tree {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            line-height: 1.8;
        }
        
        .tree-node {
            color: var(--text-color);
        }
        
        .tree-component {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .tree-description {
            color: #6b7280;
            font-style: italic;
        }
        
        footer {
            background: var(--text-color);
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 60px;
        }
        
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            h1 { font-size: 2rem; }
            h2 { font-size: 1.6rem; }
            .component-grid { grid-template-columns: 1fr; }
            .nav-links { flex-direction: column; gap: 10px; }
            .flow-diagram { flex-direction: column; }
            .flow-arrow { transform: rotate(90deg); }
            .board-demo { flex-direction: column; }
            .demo-column { min-width: auto; }
        }
        
        /* Custom scrollbar for code blocks */
        .code-block::-webkit-scrollbar {
            height: 6px;
        }
        
        .code-block::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .code-block::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>AppFlowy Kanban Board Implementation</h1>
            <p class="subtitle">Deep Dive into Board View Architecture and Interaction Patterns</p>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-links">
                <a href="#overview" class="active">Board Overview</a>
                <a href="#architecture">Architecture</a>
                <a href="#interactions">User Interactions</a>
                <a href="#state-management">State Management</a>
                <a href="#ui-components">UI Components</a>
                <a href="#implementation">Web Implementation</a>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <section id="overview" class="section">
                <h2>📋 Kanban Board Overview</h2>
                
                <div class="info">
                    <strong>Key Insight:</strong> AppFlowy's kanban board is built using the external <span class="inline-code">appflowy_board</span> package, providing sophisticated drag-and-drop functionality with custom card builders and group management.
                </div>

                <h3>🎯 Board View Features</h3>
                <div class="feature-list">
                    <div class="feature-item">
                        <div class="feature-icon drag">🔄</div>
                        <div>
                            <strong>Drag & Drop</strong><br>
                            <small>Three-tier drag system: within groups, between groups, and group reordering</small>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon create">➕</div>
                        <div>
                            <strong>Quick Card Creation</strong><br>
                            <small>Multiple creation methods with keyboard shortcuts and positional control</small>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon edit">✏️</div>
                        <div>
                            <strong>In-place Editing</strong><br>
                            <small>Direct card editing with field-specific editors and validation</small>
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon keyboard">⌨️</div>
                        <div>
                            <strong>Keyboard Navigation</strong><br>
                            <small>Comprehensive keyboard shortcuts with focus management and selection</small>
                        </div>
                    </div>
                </div>

                <h3>📱 Visual Board Demo</h3>
                <div class="board-demo">
                    <div class="demo-column">
                        <div class="demo-header">📝 To Do (3)</div>
                        <div class="demo-card">
                            <strong>Design system review</strong><br>
                            <small style="color: #6b7280;">Priority: High</small>
                        </div>
                        <div class="demo-card">
                            <strong>User research analysis</strong><br>
                            <small style="color: #6b7280;">Due: Tomorrow</small>
                        </div>
                        <div class="demo-card">
                            <strong>Create wireframes</strong><br>
                            <small style="color: #6b7280;">Assignee: Alice</small>
                        </div>
                    </div>
                    
                    <div class="demo-column">
                        <div class="demo-header">🔄 In Progress (2)</div>
                        <div class="demo-card">
                            <strong>Implement auth flow</strong><br>
                            <small style="color: #6b7280;">Progress: 60%</small>
                        </div>
                        <div class="demo-card">
                            <strong>Database optimization</strong><br>
                            <small style="color: #6b7280;">Review pending</small>
                        </div>
                    </div>
                    
                    <div class="demo-column">
                        <div class="demo-header">✅ Done (4)</div>
                        <div class="demo-card">
                            <strong>Setup CI/CD pipeline</strong><br>
                            <small style="color: #22c55e;">Completed today</small>
                        </div>
                        <div class="demo-card">
                            <strong>Initial project setup</strong><br>
                            <small style="color: #22c55e;">All tests passing</small>
                        </div>
                    </div>
                </div>

                <div class="success">
                    <strong>🎨 Design Philosophy:</strong> The board view transforms structured database rows into an intuitive visual workflow, making project management and task tracking naturally collaborative and efficient.
                </div>
            </section>

            <section id="architecture" class="section">
                <h2>🏗️ Board Architecture</h2>

                <h3>Core Component Structure</h3>
                <div class="architecture-tree">
<span class="tree-component">BoardPage</span> <span class="tree-description">// Main board container</span>
├── <span class="tree-component">AppFlowyBoard</span> <span class="tree-description">// External drag-and-drop widget</span>
│   ├── <span class="tree-component">BoardColumnHeader</span> <span class="tree-description">// Dynamic column headers</span>
│   │   ├── Field-based headers <span class="tree-description">// SingleSelect/MultiSelect</span>
│   │   ├── Checkbox headers <span class="tree-description">// Special toggle functionality</span>
│   │   └── Default headers <span class="tree-description">// Options menu + add button</span>
│   ├── <span class="tree-component">BoardColumn</span> <span class="tree-description">// Individual column container</span>
│   │   └── <span class="tree-component">RowCard</span> <span class="tree-description">// Card representation of database rows</span>
│   │       ├── Cover images <span class="tree-description">// File, asset, color, gradient</span>
│   │       ├── <span class="tree-component">CardField</span> <span class="tree-description">// Field-specific cell renderers</span>
│   │       └── Hover/focus states <span class="tree-description">// Interaction feedback</span>
│   └── <span class="tree-component">BoardColumnFooter</span> <span class="tree-description">// Quick card creation</span>
├── <span class="tree-component">HiddenGroupsColumn</span> <span class="tree-description">// Collapsible hidden groups sidebar</span>
└── <span class="tree-component">BoardFocusScope</span> <span class="tree-description">// Keyboard navigation system</span>
                </div>

                <h3>State Management Architecture</h3>
                <div class="component-grid">
                    <div class="component-card">
                        <h4>BoardBloc</h4>
                        <p>Primary business logic coordinator managing board operations, group state, and drag-and-drop interactions.</p>
                        <div class="code-block">
                            <div class="code-title">Dart</div>
class BoardBloc extends Bloc&lt;BoardEvent, BoardState&gt; {
  final DatabaseController databaseController;
  final AppFlowyBoardController boardController;
  
  // Handles card movement, group operations, and state sync
  void _onMoveGroup(MoveGroup event, emit) {
    // Group reordering logic
  }
  
  void _onMoveGroupItem(MoveGroupItem event, emit) {
    // Card movement within/between groups
  }
}
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>BoardActionsCubit</h4>
                        <p>Manages UI actions and transitions, controlling edit states, focus management, and interaction modes.</p>
                        <div class="code-block">
                            <div class="code-title">Dart</div>
class BoardActionsCubit extends Cubit&lt;BoardActionsState&gt; {
  // UI state management
  void startEditingRow(GroupedRowId groupedRowId) {
    emit(BoardActionsState.startEditingRow(groupedRowId));
  }
  
  void endEditingRow() {
    emit(const BoardActionsState.endEditingRow());
  }
}
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>GroupController</h4>
                        <p>Backend controller managing individual column data, row filtering, and group-specific operations.</p>
                        <div class="code-block">
                            <div class="code-title">Rust</div>
impl GroupController {
    pub async fn move_row(&mut self, context: MoveGroupRowContext) 
        -> FlowyResult&lt;()&gt; {
        // Handle row movement between groups
        // Update field values based on target group
    }
    
    pub fn group_rows(&self) -> Vec&lt;GroupRowsNotificationPB&gt; {
        // Filter and organize rows by group criteria
    }
}
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>GroupControllerDelegate</h4>
                        <p>Coordination layer between frontend board controller and backend group management.</p>
                        <div class="code-block">
                            <div class="code-title">Dart</div>
class GroupControllerDelegateImpl {
  final AppFlowyBoardController boardController;
  final FieldController fieldController;
  
  void onNewColumnItem(String groupId, RowMetaPB row, int index) {
    // Handle new card creation in specific group
    boardController.insertGroupItem(groupId, index, item);
  }
}
                        </div>
                    </div>
                </div>

                <h3>Drag and Drop System</h3>
                <div class="info">
                    <strong>Three-Tier Drag System:</strong> AppFlowy implements a sophisticated drag system that handles different types of movements with proper constraints and validation.
                </div>

                <div class="code-block">
                    <div class="code-title">Flutter Widget Configuration</div>
AppFlowyBoard(
  boardScrollController: scrollManager,
  controller: boardController,
  groupConstraints: BoxConstraints.tightFor(width: compactMode ? 196 : 256),
  
  // Three types of drag operations
  onMoveGroup: (fromGroupId, fromIndex, toGroupId, toIndex) =>
      context.read&lt;BoardBloc&gt;().add(BoardEvent.moveGroup(
        fromGroupId: fromGroupId,
        toGroupId: toGroupId,
      )),
      
  onMoveGroupItem: (groupId, fromIndex, toIndex) =>
      context.read&lt;BoardBloc&gt;().add(BoardEvent.moveGroupItem(
        groupId: groupId,
        fromIndex: fromIndex,
        toIndex: toIndex,
      )),
      
  onMoveGroupItemToGroup: (fromGroupId, fromIndex, toGroupId, toIndex) =>
      context.read&lt;BoardBloc&gt;().add(BoardEvent.moveGroupItemToGroup(
        fromGroupId: fromGroupId,
        fromIndex: fromIndex,
        toGroupId: toGroupId,
        toIndex: toIndex,
      )),
      
  // Drag state management
  onStartDraggingCard: (groupId, index) {
    focusScope.clear(); // Clear focus during drag
  },
)
                </div>
            </section>

            <section id="interactions" class="section">
                <h2>🎮 User Interaction Patterns</h2>

                <h3>Card Creation Workflows</h3>
                <div class="flow-diagram">
                    <div class="flow-step">
                        <strong>Quick Create</strong><br>
                        Column Footer
                    </div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-step">
                        <strong>Text Input</strong><br>
                        FlowyTextField
                    </div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-step">
                        <strong>Board Event</strong><br>
                        createRow()
                    </div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-step">
                        <strong>Auto Scroll</strong><br>
                        scrollToBottom()
                    </div>
                </div>

                <h4>Creation Methods</h4>
                <ul>
                    <li><strong>Footer Button:</strong> Creates card at bottom of column with immediate text input</li>
                    <li><strong>Header Button:</strong> Creates card at top using <span class="inline-code">OrderObjectPositionTypePB.Start</span></li>
                    <li><strong>Keyboard Shortcuts:</strong>
                        <ul>
                            <li><span class="inline-code">N</span> key: Quick create at bottom</li>
                            <li><span class="inline-code">Shift+Enter</span>: Create after current selection</li>
                            <li><span class="inline-code">Shift+Cmd+Up</span>: Create before current selection</li>
                        </ul>
                    </li>
                </ul>

                <h3>Keyboard Navigation System</h3>
                <div class="component-card">
                    <h4>BoardFocusScope - Sophisticated Focus Management</h4>
                    <div class="code-block">
                        <div class="code-title">Keyboard Shortcuts</div>
Map&lt;ShortcutActivator, AFBindingCallback&gt; _shortcutBindings(context) => {
  // Navigation
  SingleActivator(LogicalKeyboardKey.arrowUp): focusScope.focusPrevious,
  SingleActivator(LogicalKeyboardKey.arrowDown): focusScope.focusNext,
  SingleActivator(LogicalKeyboardKey.arrowLeft): focusScope.focusLeft,
  SingleActivator(LogicalKeyboardKey.arrowRight): focusScope.focusRight,
  
  // Multi-selection
  LogicalKeySet(LogicalKeyboardKey.shift, LogicalKeyboardKey.arrowUp): 
      focusScope.focusPreviousWithSelection,
      
  // Card operations
  SingleActivator(LogicalKeyboardKey.keyE): () => startEditingCard(),
  SingleActivator(LogicalKeyboardKey.delete): () => deleteCard(),
  SingleActivator(LogicalKeyboardKey.keyN): () => createNewCard(),
  
  // View operations
  SingleActivator(LogicalKeyboardKey.escape): () => clearFocus(),
};
                    </div>
                </div>

                <h3>Card Editing Patterns</h3>
                <div class="component-grid">
                    <div class="component-card">
                        <h4>In-place Title Editing</h4>
                        <p>Primary field supports direct text editing with automatic save and validation.</p>
                    </div>
                    <div class="component-card">
                        <h4>Field-Specific Editors</h4>
                        <p>Each field type uses specialized editors (date pickers, select dropdowns, etc.).</p>
                    </div>
                    <div class="component-card">
                        <h4>Modal Detail View</h4>
                        <p>Full card editor with rich document editing and field management.</p>
                    </div>
                    <div class="component-card">
                        <h4>Batch Operations</h4>
                        <p>Multi-select support for bulk editing and operations.</p>
                    </div>
                </div>

                <h3>Responsive Interaction Patterns</h3>
                <div class="warning">
                    <strong>Platform Adaptations:</strong> AppFlowy implements completely different interaction patterns for mobile vs desktop, optimizing for touch vs mouse/keyboard input methods.
                </div>

                <ul>
                    <li><strong>Desktop:</strong> Keyboard-first navigation with comprehensive shortcuts</li>
                    <li><strong>Mobile:</strong> Touch-optimized drag handles and swipe gestures</li>
                    <li><strong>Compact Mode:</strong> Reduced column width (196px vs 256px) for smaller screens</li>
                    <li><strong>Hover States:</strong> Rich visual feedback for mouse interactions</li>
                </ul>
            </section>

            <section id="state-management" class="section">
                <h2>🔄 State Management Patterns</h2>

                <h3>Optimistic Updates with Backend Sync</h3>
                <div class="flow-diagram">
                    <div class="flow-step">
                        <strong>UI Action</strong><br>
                        User drags card
                    </div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-step">
                        <strong>Optimistic Update</strong><br>
                        Board UI updates
                    </div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-step">
                        <strong>Backend Call</strong><br>
                        Database update
                    </div>
                    <div class="flow-arrow">→</div>
                    <div class="flow-step">
                        <strong>Confirmation</strong><br>
                        State reconciliation
                    </div>
                </div>

                <h3>Event-Driven State Updates</h3>
                <div class="code-block">
                    <div class="code-title">State Flow Pattern</div>
// 1. User action triggers optimistic UI update
boardController.insertGroupItem(groupId, index, item);

// 2. BLoC event triggers backend operation  
context.read&lt;BoardBloc&gt;().add(BoardEvent.createRow(
  groupId: groupId,
  position: OrderObjectPositionTypePB.End,
  name: cardTitle,
));

// 3. Backend processes and notifies of changes
DatabaseNotification.DidUpdateViewRowsVisibility.listen((notification) {
  // Update local state based on backend confirmation
});

// 4. UI reconciles any differences between optimistic and actual state
                </div>

                <h3>Group State Synchronization</h3>
                <div class="info">
                    <strong>Real-time Group Updates:</strong> Groups automatically update when underlying field values change, maintaining consistency between the database view and board representation.
                </div>

                <div class="component-grid">
                    <div class="component-card">
                        <h4>Group Creation</h4>
                        <p>New groups appear automatically when SingleSelect field options are added.</p>
                        <div class="code-block">
                            <div class="code-title">Auto Group Creation</div>
// When user adds new option to SingleSelect field
fieldController.insertOption(index, optionName)
  .then(() => {
    // Group automatically created in board view
    // No manual group creation needed
  });
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>Row Assignment</h4>
                        <p>Cards automatically move between groups when their field values change.</p>
                        <div class="code-block">
                            <div class="code-title">Automatic Grouping</div>
// When card's status field changes
cellController.updateCell(cellData)
  .then(() => {
    // Card automatically moves to appropriate group
    // Board view updates in real-time
  });
                        </div>
                    </div>
                </div>

                <h3>Focus and Selection State</h3>
                <div class="code-block">
                    <div class="code-title">Focus Management</div>
class BoardFocusScope {
  // Maintains selection across operations
  List&lt;GroupedRowId&gt; _focusedGroupedRows = [];
  
  void focusNext() {
    final current = _focusedGroupedRows.lastOrNull;
    if (current == null) return;
    
    final nextRowId = _findNextRowId(current);
    if (nextRowId != null) {
      focus(nextRowId);
      _scrollToFocusedRow(nextRowId);
    }
  }
  
  void focusPreviousWithSelection() {
    // Extend selection while moving focus
    final previous = _findPreviousRowId();
    if (previous != null) {
      _focusedGroupedRows.add(previous);
      _updateSelectionUI();
    }
  }
}
                </div>
            </section>

            <section id="ui-components" class="section">
                <h2>🎨 UI Component Design</h2>

                <h3>Card Styling System</h3>
                <div class="code-block">
                    <div class="code-title">Field-Specific Card Styling</div>
CardCellStyleMap desktopBoardCardCellStyleMap(context) => {
  FieldType.RichText: TextCardCellStyle(
    padding: EdgeInsets.all(4),
    textStyle: textStyle,
    maxLines: 2, // Truncate long text
    titleTextStyle: Theme.of(context).textTheme.bodyMedium,
  ),
  
  FieldType.SingleSelect: SelectOptionCardCellStyle(
    tagFontSize: 11,
    wrap: true, // Wrap multiple tags
    tagPadding: EdgeInsets.symmetric(horizontal: 4, vertical: 2),
  ),
  
  FieldType.MultiSelect: SelectOptionCardCellStyle(
    tagFontSize: 11,
    wrap: true,
    showTagCount: true, // Show "+2 more" for overflow
  ),
  
  FieldType.DateTime: DateCardCellStyle(
    timeFormat: TimeFormat.TwentyFourHour,
    dateFormat: DateFormat.US,
  ),
};
                </div>

                <h3>Visual Feedback Systems</h3>
                <div class="component-grid">
                    <div class="component-card">
                        <h4>Drag Indicators</h4>
                        <ul>
                            <li>Card opacity reduction during drag (80%)</li>
                            <li>Drop zone highlighting</li>
                            <li>Animated card positioning</li>
                            <li>Shadow elevation changes</li>
                        </ul>
                    </div>

                    <div class="component-card">
                        <h4>Focus States</h4>
                        <ul>
                            <li>Primary border color for focused cards</li>
                            <li>Multi-selection visual indicators</li>
                            <li>Keyboard navigation breadcrumbs</li>
                            <li>Smooth focus transitions</li>
                        </ul>
                    </div>

                    <div class="component-card">
                        <h4>Hover Effects</h4>
                        <ul>
                            <li>Subtle background color changes</li>
                            <li>Action button visibility</li>
                            <li>Tooltip information display</li>
                            <li>Cursor state changes</li>
                        </ul>
                    </div>

                    <div class="component-card">
                        <h4>Loading States</h4>
                        <ul>
                            <li>Skeleton loading for new cards</li>
                            <li>Shimmer effects during updates</li>
                            <li>Progress indicators for bulk operations</li>
                            <li>Error state handling and retry</li>
                        </ul>
                    </div>
                </div>

                <h3>Cover Image System</h3>
                <div class="code-block">
                    <div class="code-title">Cover Image Rendering</div>
Widget renderCoverImage(RowMeta meta) {
  if (meta.cover == null) return SizedBox.shrink();
  
  final cover = meta.cover!;
  
  switch (cover.cover_type) {
    case RowCoverType.ColorCover:
    case RowCoverType.GradientCover:
      return Container(
        height: 100,
        decoration: BoxDecoration(
          gradient: renderColor(cover.data), // Convert color data to gradient
        ),
      );
      
    case RowCoverType.AssetCover:
      final assetUrl = {
        '1': '/covers/m_cover_image_1.png',
        '2': '/covers/m_cover_image_2.png',
        // ... predefined asset mappings
      }[cover.data];
      
      return ImageRender(
        src: assetUrl,
        height: 100,
        fit: BoxFit.cover,
      );
      
    case RowCoverType.FileCover:
      return NetworkImage(
        src: cover.data,
        height: 100,
        loadingBuilder: (context, child, progress) => ShimmerEffect(),
        errorBuilder: (context, error, stack) => PlaceholderImage(),
      );
  }
}
                </div>
            </section>

            <section id="implementation" class="section">
                <h2>🚀 Web Implementation Guide</h2>

                <h3>Essential Web Libraries</h3>
                <div class="component-grid">
                    <div class="component-card">
                        <h4>@dnd-kit/core</h4>
                        <p>Modern drag-and-drop library that matches AppFlowy's three-tier drag system capabilities.</p>
                        <div class="code-block">
                            <div class="code-title">React Implementation</div>
import {
  DndContext,
  DragEndEvent,
  DragStartEvent,
} from '@dnd-kit/core';

function KanbanBoard() {
  const handleDragEnd = (event: DragEndEvent) => {
    const { active, over } = event;
    // Handle three types of drops:
    // 1. Same column reorder
    // 2. Cross-column move  
    // 3. Column reorder
  };
}
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>Zustand + Immer</h4>
                        <p>State management replacement for Flutter BLoC pattern with immutable updates.</p>
                        <div class="code-block">
                            <div class="code-title">State Store</div>
const useBoardStore = create(
  immer((set, get) => ({
    groups: [],
    focusedCard: null,
    
    moveCard: (cardId, targetGroup, position) => 
      set(state => {
        // Optimistic update
        // Then trigger backend sync
      }),
      
    createCard: (groupId, title) =>
      set(state => {
        // Immediate UI update
        state.groups[groupId].cards.push(newCard);
      }),
  }))
);
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>React Query</h4>
                        <p>Data fetching and synchronization to replace Flutter's stream-based approach.</p>
                        <div class="code-block">
                            <div class="code-title">Data Sync</div>
const useBoardData = (viewId) => {
  return useQuery({
    queryKey: ['board', viewId],
    queryFn: () => boardService.loadBoard(viewId),
    onSuccess: (data) => {
      // Update local board state
      useBoardStore.getState().setGroups(data.groups);
    },
  });
};
                        </div>
                    </div>

                    <div class="component-card">
                        <h4>React Hotkeys</h4>
                        <p>Comprehensive keyboard shortcut system matching AppFlowy's navigation.</p>
                        <div class="code-block">
                            <div class="code-title">Keyboard Shortcuts</div>
const boardHotkeys = [
  ['ArrowUp', () => focusPreviousCard()],
  ['ArrowDown', () => focusNextCard()],
  ['shift+ArrowUp', () => extendSelectionUp()],
  ['n', () => createNewCard()],
  ['e', () => editFocusedCard()],
  ['delete', () => deleteSelectedCards()],
];
                        </div>
                    </div>
                </div>

                <h3>Key Implementation Patterns</h3>
                
                <div class="highlight">Component Architecture</div>
                <p>Maintain the same component hierarchy: Board → Groups → Cards with clear separation of concerns.</p>

                <div class="highlight">Optimistic Updates</div>
                <p>Implement immediate UI feedback with backend synchronization and rollback capabilities.</p>

                <div class="highlight">Keyboard-First Design</div>
                <p>Comprehensive keyboard navigation is essential for power users - don't treat it as an afterthought.</p>

                <div class="highlight">Field-Specific Styling</div>
                <p>Create a styling system that adapts card appearance based on field types and content.</p>

                <h3>Performance Considerations</h3>
                <ul>
                    <li><strong>Virtual Scrolling:</strong> Use react-window for boards with many cards</li>
                    <li><strong>Debounced Updates:</strong> Batch rapid state changes to prevent excessive re-renders</li>
                    <li><strong>Memoization:</strong> Aggressively memoize card components and field renderers</li>
                    <li><strong>Lazy Loading:</strong> Load card details on-demand as they enter viewport</li>
                    <li><strong>Animation Performance:</strong> Use transform-based animations for smooth 60fps drag operations</li>
                </ul>

                <div class="warning">
                    <strong>Critical Success Factors:</strong>
                    <ol>
                        <li>Implement the three-tier drag system exactly as in desktop version</li>
                        <li>Maintain keyboard navigation parity for power users</li>
                        <li>Preserve optimistic update patterns for responsive UX</li>
                        <li>Implement field-specific card styling for visual consistency</li>
                        <li>Ensure proper focus management and accessibility</li>
                    </ol>
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 AppFlowy Kanban Board Implementation | Technical Documentation for Web Development</p>
        </div>
    </footer>
</body>
</html>